---
const { pathname } = Astro.url

const hideLogoRoutes = ['/']
const shouldShowLogo = !hideLogoRoutes.includes(pathname)
const isActive = (path: string) => pathname === path
---

<div class="fixed right-8 top-8 z-[100] md:hidden">
  <button
    id="menuButton"
    aria-expanded="false"
    aria-controls="menuMobileContent"
    class="hamburgerButton group relative flex h-[20px] w-6 cursor-pointer flex-col items-center justify-between transition duration-300 hover:scale-110 lg:hidden"
    aria-label="Abrir menú de navegación"
  >
    <span class="ease h-[2px] w-6 transform bg-gray-300 transition duration-300 group-[.open]:translate-y-2 group-[.open]:rotate-45"></span>
    <span class="ease h-[2px] w-6 transform bg-gray-300 transition duration-300 group-[.open]:opacity-0"></span>
    <span class="ease h-[2px] w-6 transform bg-gray-300 transition duration-300 group-[.open]:opacity-0"></span>
    <span class="ease h-[2px] w-6 transform bg-gray-300 transition duration-300 group-[.open]:-translate-y-[0.6rem] group-[.open]:-rotate-45"></span>
  </button>
</div>

<header class="fixed top-0 z-50 mx-auto flex w-full select-none items-center text-white md:h-20 h-16 overflow-visible">
  <div class="relative flex justify-between px-6 py-4 md:w-full w-full overflow-visible">
    <a href="/" class="cursor-pointer transition duration-300 hover:scale-110 md:hidden">
      <img src="/favicon.svg" alt="logo" class="h-auto w-7" />
    </a>

    <div id="overlay-menu" class="bg-black/50 fixed inset-0 hidden h-screen md:hidden"></div>
    <nav
      id="navContent"
      class="relative invisible fixed right-0 top-0 mx-auto h-screen w-full max-w-none translate-x-full items-center justify-between space-y-2 px-6 pt-14 text-xs font-light backdrop-blur-2xl 
      md:visible md:relative md:flex md:!h-fit md:w-full md:translate-x-0 md:space-y-0 md:bg-transparent md:py-4 md:backdrop-blur-none md:justify-between md:items-center lg:text-sm overflow-visible"
    >
      {/* IZQUIERDA */}
      <div class="flex flex-col justify-start space-y-2 md:flex-row md:gap-12 md:space-y-0 md:w-1/2 md:justify-start">
        <a href="/nosotros" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/nosotros') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">Nosotros</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/nosotros') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/nosotros') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
        <a href="/soluciones" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/soluciones') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">Soluciones</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/soluciones') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/soluciones') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
        <a href="/responsabilidad-corporativa" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/responsabilidad-corporativa') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">Responsabilidad Corporativa</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/responsabilidad-corporativa') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/responsabilidad-corporativa') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
      </div>

      {/* DERECHA */}
      <div class="flex flex-col md:flex-row md:gap-12 md:space-y-0 md:w-1/2 md:justify-end">
          <a href="/anto-web" class:list={[
            'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
            isActive('/servicios') ? 'font-bold text-[#FFC72C]' : ''
          ]}>
            <span class="py-1">Servicios</span>
            <div class="relative mt-1 h-[2px] w-full overflow-hidden">
              <div class:list={[
                'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
                isActive('/anto-web') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
              ]}></div>
              <div class:list={[
                'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
                isActive('/servicios') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
              ]}></div>
            </div>
          </a>
        <a href="/seguridad" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/seguridad') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">Seguridad</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/seguridad') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/seguridad') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
        <a href="/diesal-service" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/diesal-service') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">DieselService</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/diesal-service') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/diesal-service') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
        <a href="/contactanos" class:list={[
          'group relative inline-block w-fit py-1 leading-relaxed tracking-wider',
          isActive('/contactanos') ? 'font-bold text-[#FFC72C]' : ''
        ]}>
          <span class="py-1">Contáctanos</span>
          <div class="relative mt-1 h-[2px] w-full overflow-hidden">
            <div class:list={[
              'absolute bottom-0 left-0 h-full bg-[#c8102e] transition-all duration-300 ease-out',
              isActive('/contactanos') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
            <div class:list={[
              'absolute bottom-0 right-0 h-full bg-[#FFC72C] transition-all duration-300 ease-out',
              isActive('/contactanos') ? 'w-[51%]' : 'w-0 group-hover:w-[51%]',
            ]}></div>
          </div>
        </a>
      </div>
    </nav>

    {/* LOGO ABSOLUTO SOBRE EL HEADER */}
    <a
      href="/"
      class="hidden md:inline-block absolute left-1/2 top-[100%] z-50 -translate-x-1/2 -translate-y-1/2 pointer-events-auto transition duration-500 hover:scale-110"
      style="height: 160px; width: 160px;"
      aria-label="Ir al inicio"
    >
      <img src="/logo-trcoralv-basic.webp" alt="logo" class="logo-glow-teal w-full h-full object-contain" />
    </a>
  </div>
</header>

<style>
  header {
    background: rgba(0, 0, 0, 0); 
    animation: header-blur-scroll 0.3s linear both;
    animation-timeline: scroll();
    animation-range: 0 250px;
    border-bottom: 1px solid transparent;
    overflow: visible;
  }

  @keyframes header-blur-scroll {
    0% {
      backdrop-filter: blur(0px);
      background: rgba(0, 0, 0, 0); 
    }
    100% {
      backdrop-filter: blur(10px);
      background: rgba(0, 0, 0, 0.5); 
      padding-bottom: var(--spacing-6);
      border-bottom-color: black;
    }
  }

  #navContent {
    transition:
      translate 0.3s ease-in-out,
      visibility 0.3s 0.3s;
    overflow: visible;
  }
  #navContent.showing {
    visibility: visible;
    translate: 0 0;
    transition:
      translate 0.3s ease-in-out,
      visibility 0.3s;
  }
  .logo-glow-teal {
    filter: drop-shadow(0 0 6px #FFC72C) drop-shadow(0 0 1px #fff);
  }
</style>

<script>
  import { $ } from '../lib/dom-selector'

  document.addEventListener('astro:page-load', () => {
    function toggleMenu(
      menuBtn: Element | null,
      navContent: Element | null,
      overlayMenu: Element | null,
    ) {
      menuBtn?.classList.toggle('open')
      navContent?.classList.toggle('showing')
      overlayMenu?.classList.toggle('hidden')
    }

    const navContent = $('#navContent')
    const menuButton = $('#menuButton')
    const overlayMenu = $('#overlay-menu')

    menuButton?.addEventListener('click', () => toggleMenu(menuButton, navContent, overlayMenu))
    overlayMenu?.addEventListener('click', () => toggleMenu(menuButton, navContent, overlayMenu))
  })
</script>